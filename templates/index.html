{% extends 'layout.html' %}

{% block content %}
<h2>Welcome, {{ username }}</h2>
<div class="mb-3">
  <h4>Current month total: {{ symbol }}{{ '%.2f' % total }}</h4>
</div>

<div class="row">
  <div class="col-md-6">
    <h5>Add Expense</h5>
    <form method="POST" action="/add_expense">
      <div class="mb-2">
        <label for="category_id" class="form-label">Category</label>
        <select class="form-select" name="category_id" id="category_id">
          {% for c in categories %}
            <option value="{{ c['id'] }}">{{ c['name'] }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="mb-2">
        <label for="amount" class="form-label">Amount</label>
        <input type="number" step="0.01" name="amount" id="amount" class="form-control">
      </div>
      <div class="mb-2">
        <label for="description" class="form-label">Description</label>
        <input type="text" name="description" id="description" class="form-control">
      </div>
      <div class="mb-2">
        <label for="date" class="form-label">Date</label>
        <input type="date" name="date" id="date" class="form-control" value="{{ datetime.utcnow().date() }}">
      </div>
      <button type="submit" class="btn btn-primary">Add Expense</button>
    </form>
  </div>
  <div class="col-md-6">
    <h5>Recent Expenses</h5>
    <table class="table table-sm">
      <thead>
        <tr>
          <th>Date</th>
          <th>Category</th>
          <th>Amount</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for e in expenses %}
        <tr>
          <td>{{ e['date'] }}</td>
          <td>{{ e['category_name'] }}</td>
          <td>{{ symbol }}{{ '%.2f' % e['amount'] }}</td>
          <td><a href="/delete_expense/{{ e['id'] }}" class="btn btn-sm btn-danger">Delete</a></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<hr>
<div>
  <h5>Spending by category</h5>
  <canvas id="categoryChart" width="400" height="200"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
var ctx = document.getElementById('categoryChart').getContext('2d');
var chart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: [
            {% for c in category_totals %}
            "{{ c['name'] }}",
            {% endfor %}
        ],
        datasets: [{
            label: 'Spending',
            data: [
              {% for c in category_totals %}
              {{ '%.2f' % c['total'] }},
              {% endfor %}
            ],
            backgroundColor: 'rgba(54, 162, 235, 0.5)'
        }]
    }
});
</script>
{% endblock %}

